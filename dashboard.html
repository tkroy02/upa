<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheduler Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="dashboard.css">
    <style>
        /* Additional styles for improved features */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white, #fff);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 1rem 1.5rem;
            z-index: 3000;
            transform: translateX(400px);
            transition: all 0.3s ease;
            max-width: 350px;
        }
        .toast.show { transform: translateX(0); }
        .toast-success { border-left: 4px solid #48bb78; }
        .toast-error { border-left: 4px solid #e63946; }
        .toast-warning { border-left: 4px solid #f77f00; }
        
        .loading {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-out {
            opacity: 0.5;
            text-decoration: line-through;
            pointer-events: none;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-content {
            animation: slideIn 0.3s ease;
        }

        /* Settings specific styles */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .settings-card {
            background: var(--card-bg, #f7f9fc);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .settings-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-color-primary, #1e293b);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .settings-title i {
            color: var(--primary);
        }
        .settings-options .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color-secondary, #64748b);
        }
        .form-control, .form-select, .form-range {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color, #e2e8f0);
            border-radius: 8px;
            background: var(--input-bg, #fff);
            color: var(--text-color-primary, #1e293b);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-control:focus, .form-select:focus, .form-range:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }
        .color-picker {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.2s ease, border-color 0.2s ease;
        }
        .color-option.selected {
            border-color: var(--text-color-primary, #1e293b);
            transform: scale(1.1);
        }
        .form-check {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .form-check-input {
            width: 20px;
            height: 20px;
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .mt-10 { margin-top: 10px; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-calendar-alt"></i> <span>Scheduler</span></h2>
            </div>
            <ul class="sidebar-menu">
                <li class="menu-item active" data-tab="dashboard">
                    <i class="fas fa-home"></i> <span>Dashboard</span>
                </li>
                <li class="menu-item" data-tab="sessions">
                    <i class="fas fa-clock"></i> <span>Sessions</span>
                </li>
                <li class="menu-item" data-tab="availability">
                    <i class="fas fa-calendar-plus"></i> <span>Availability</span>
                </li>
                <li class="menu-item" data-tab="tutors">
                    <i class="fas fa-chalkboard-teacher"></i> <span>Tutors</span>
                </li>
                <li class="menu-item" data-tab="calendar">
                    <i class="fas fa-calendar"></i> <span>Calendar</span>
                </li>
                <li class="menu-item" data-tab="settings">
                    <i class="fas fa-cog"></i> <span>Settings</span>
                </li>
            </ul>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="welcome-msg">
                    Welcome back, <span id="userName">User</span>!
                </div>
                <div class="user-actions">
                    <div class="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <div id="dashboardContent">
                <div class="dashboard-cards">
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: rgba(67, 97, 238, 0.15); color: var(--primary);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="upcomingSessionsCount">0</div>
                            <div class="stat-title">Upcoming Sessions</div>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: rgba(76, 201, 240, 0.15); color: var(--success);">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="completedSessionsCount">0</div>
                            <div class="stat-title">Completed Sessions</div>
                        </div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-icon" style="background: rgba(247, 37, 133, 0.15); color: var(--warning);">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="availableTutorsCount">0</div>
                            <div class="stat-title">Available Tutors</div>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h3 class="section-title">Upcoming Sessions</h3>
                        <div class="section-actions">
                            <button class="btn btn-outline">
                                <i class="fas fa-calendar"></i> View All
                            </button>
                        </div>
                    </div>
                    <div class="sessions-container" id="upcomingSessions">
                        </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <h3 class="section-title">Recent Activity</h3>
                    </div>
                    <div class="activity-list" id="recentActivity">
                        </div>
                </div>
            </div>

            <div id="settingsContent" class="content-section hidden">
                <div class="section-header">
                    <h3 class="section-title">Settings</h3>
                </div>
                
                <div class="settings-grid">
                    <div class="settings-card">
                        <h4 class="settings-title">
                            <i class="fas fa-palette"></i> Appearance
                        </h4>
                        <div class="settings-options">
                            <div class="form-group">
                                <label class="form-label">Theme</label>
                                <select id="themeSelect" class="form-control">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                    <option value="system">System Default</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Accent Color</label>
                                <div class="color-picker">
                                    <div class="color-option" data-color="var(--primary)" style="background: var(--primary);"></div>
                                    <div class="color-option" data-color="#7c3aed" style="background: #7c3aed;"></div>
                                    <div class="color-option" data-color="#059669" style="background: #059669;"></div>
                                    <div class="color-option" data-color="#dc2626" style="background: #dc2626;"></div>
                                    <div class="color-option" data-color="#ea580c" style="background: #ea580c;"></div>
                                    <div class="color-option" data-color="#028FF7" style="background: #028FF7;"></div>
                                    <div class="color-option" data-color="#b8860b" style="background: #b8860b;"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Font Size</label>
                                <input type="range" id="fontSizeSlider" min="12" max="18" value="16" class="form-range">
                                <div class="range-labels">
                                    <span>Small</span>
                                    <span>Medium</span>
                                    <span>Large</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h4 class="settings-title">
                            <i class="fas fa-user-cog"></i> Account Settings
                        </h4>
                        <div class="settings-options">
                            <div class="form-group">
                                <label class="form-label">Name</label>
                                <input type="text" id="userNameInput" class="form-control" placeholder="Your name">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" id="userEmailInput" class="form-control" placeholder="Your email">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Change Password</label>
                                <input type="password" id="currentPassword" class="form-control" placeholder="Current password">
                                <input type="password" id="newPassword" class="form-control mt-10" placeholder="New password">
                                <input type="password" id="confirmPassword" class="form-control mt-10" placeholder="Confirm new password">
                            </div>
                            
                            <button class="btn btn-primary" id="saveAccountSettings">Save Changes</button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h4 class="settings-title">
                            <i class="fas fa-bell"></i> Notifications
                        </h4>
                        <div class="settings-options">
                            <div class="form-check">
                                <input type="checkbox" id="emailNotifications" class="form-check-input" checked>
                                <label class="form-check-label" for="emailNotifications">Email notifications</label>
                            </div>
                            
                            <div class="form-check">
                                <input type="checkbox" id="browserNotifications" class="form-check-input" checked>
                                <label class="form-check-label" for="browserNotifications">Browser notifications</label>
                            </div>
                            
                            <div class="form-group mt-20">
                                <label class="form-label">Notification Types</label>
                                <div class="form-check">
                                    <input type="checkbox" id="sessionReminders" class="form-check-input" checked>
                                    <label class="form-check-label" for="sessionReminders">Session reminders</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="newMessages" class="form-check-input" checked>
                                    <label class="form-check-label" for="newMessages">New messages</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" id="availabilityUpdates" class="form-check-input" checked>
                                    <label class="form-check-label" for="availabilityUpdates">Availability updates</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <h4 class="settings-title">
                            <i class="fas fa-shield-alt"></i> Privacy & Security
                        </h4>
                        <div class="settings-options">
                            <div class="form-check">
                                <input type="checkbox" id="twoFactorAuth" class="form-check-input">
                                <label class="form-check-label" for="twoFactorAuth">Enable two-factor authentication</label>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Auto-logout after</label>
                                <select id="autoLogout" class="form-control">
                                    <option value="15">15 minutes</option>
                                    <option value="30" selected>30 minutes</option>
                                    <option value="60">1 hour</option>
                                    <option value="120">2 hours</option>
                                    <option value="0">Never</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Data Usage</label>
                                <div class="form-check">
                                    <input type="checkbox" id="dataCollection" class="form-check-input" checked>
                                    <label class="form-check-label" for="dataCollection">Allow anonymous usage data collection</label>
                                </div>
                            </div>
                            
                            <button class="btn btn-outline" id="exportDataBtn">Export My Data</button>
                            <button class="btn btn-outline btn-danger mt-10" id="deleteAccountBtn">Delete Account</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="roleSpecificContent" class="hidden">
                </div>
        </div>
    </div>

    <div id="createSlotModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-header">
                <h3 class="modal-title">Create Availability Slot</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" id="slotDate" class="form-control">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Time</label>
                        <input type="time" id="startTime" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Time</label>
                        <input type="time" id="endTime" class="form-control">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSlotBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmCreateSlotBtn">Create Slot</button>
            </div>
        </div>
    </div>

    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-header">
                <h3 class="modal-title">Confirm Action</h3>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelActionBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmActionBtn">Confirm</button>
            </div>
        </div>
    </div>

    <div class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </div>

    <script type="module">
        // Enhanced Application Architecture
        class SchedulerApp {
            constructor() {
                this.currentUser = null;
                this.eventListeners = new Map();
                this.components = new Map();
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.authenticateUser();
            }

            setupEventListeners() {
                document.getElementById('menuToggle').addEventListener('click', () => {
                    document.getElementById('sidebar').classList.toggle('mobile-open');
                });

                this.setupModalEvents();
                this.setupNavigation();
            }

            setupModalEvents() {
                document.querySelectorAll('.close-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modal = e.target.closest('.modal');
                        if (modal) this.hideModal(modal.id);
                    });
                });

                window.addEventListener('click', (event) => {
                    if (event.target.classList.contains('modal')) {
                        this.hideModal(event.target.id);
                    }
                });

                document.getElementById('cancelSlotBtn').addEventListener('click', () => {
                    this.hideModal('createSlotModal');
                });

                document.getElementById('cancelActionBtn').addEventListener('click', () => {
                    this.hideModal('confirmationModal');
                });
            }

            setupNavigation() {
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', () => {
                        this.handleNavigation(item);
                    });
                });

                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.handleLogout();
                });
            }

            handleNavigation(item) {
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                const tabName = item.dataset.tab;
                
                // Hide all content sections first
                document.getElementById('dashboardContent').classList.add('hidden');
                document.getElementById('roleSpecificContent').classList.add('hidden');
                document.getElementById('settingsContent').classList.add('hidden');

                if (tabName === 'dashboard') {
                    this.showDashboard();
                } else if (tabName === 'calendar') {
                    this.showCalendar();
                } else if (tabName === 'settings') {
                    this.showSettings();
                } else if (tabName === 'tutors') {
                    this.showTutors();
                } else {
                    this.showToast(`${tabName.charAt(0).toUpperCase() + tabName.slice(1)} feature coming soon!`, 'warning');
                }
            }

            showCalendar() {
                const calendar = new CalendarComponent(this);
                document.getElementById('roleSpecificContent').classList.remove('hidden');
                document.getElementById('roleSpecificContent').innerHTML = '';
                calendar.render();
            }
            
            showTutors() {
                const tutors = new TutorsComponent(this);
                document.getElementById('roleSpecificContent').classList.remove('hidden');
                document.getElementById('roleSpecificContent').innerHTML = '';
                tutors.render();
            }

            showSettings() {
                document.getElementById('settingsContent').classList.remove('hidden');
                this.loadSettings();
            }

            async authenticateUser() {
                try {
                    // Simulate authentication
                    setTimeout(() => {
                        this.currentUser = {
                            uid: 'demo-user-123',
                            name: 'Demo User',
                            role: 'student', // Change to 'tutor' to see tutor dashboard
                            approved: true
                        };
                        
                        if (this.currentUser.role === 'tutor' && !this.currentUser.approved) {
                            this.showConfirmation('Your tutor account is not approved yet. Contact admin.', () => {
                                this.handleLogout();
                            });
                            return;
                        }

                        this.renderUserInterface();
                    }, 100);
                } catch (error) {
                    this.handleError('Authentication failed', error);
                }
            }

            renderUserInterface() {
                document.getElementById('userName').textContent = this.currentUser.name;
                
                if (this.currentUser.role === 'tutor') {
                    this.renderTutorDashboard();
                } else {
                    this.renderStudentDashboard();
                }
            }

            renderTutorDashboard() {
                const tutorDashboard = new TutorDashboard(this);
                this.components.set('tutorDashboard', tutorDashboard);
                tutorDashboard.render();
            }

            renderStudentDashboard() {
                const studentDashboard = new StudentDashboard(this);
                this.components.set('studentDashboard', studentDashboard);
                studentDashboard.render();
            }

            showDashboard() {
                if (this.currentUser) {
                    this.renderUserInterface();
                }
            }

            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            }

            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            }

            showConfirmation(message, onConfirm) {
                document.getElementById('confirmationMessage').textContent = message;
                this.showModal('confirmationModal');
                
                const confirmBtn = document.getElementById('confirmActionBtn');
                const newConfirmBtn = confirmBtn.cloneNode(true);
                confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
                
                if (onConfirm) {
                    newConfirmBtn.addEventListener('click', () => {
                        this.hideModal('confirmationModal');
                        onConfirm();
                    });
                }
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(toast);
                setTimeout(() => toast.classList.add('show'), 100);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => document.body.removeChild(toast), 300);
                }, 5000);
            }

            handleError(message, error) {
                console.error(message, error);
                this.showToast(`${message}. Please try again.`, 'error');
            }

            async handleLogout() {
                this.showConfirmation('Are you sure you want to logout?', async () => {
                    try {
                        // Simulate logout
                        window.location.href = 'login.html';
                    } catch (error) {
                        this.handleError('Logout failed', error);
                    }
                });
            }

            // Settings functions
            loadSettings() {
                // Load saved settings from localStorage or user profile
                const savedTheme = localStorage.getItem('theme') || 'light';
                const savedAccentColor = localStorage.getItem('accentColor') || 'var(--primary)';
                const savedFontSize = localStorage.getItem('fontSize') || '16';
                
                // Apply settings to form elements
                document.getElementById('themeSelect').value = savedTheme;
                document.getElementById('fontSizeSlider').value = savedFontSize;
                
                // Apply the settings to the UI
                this.applyTheme(savedTheme);
                this.applyAccentColor(savedAccentColor);
                this.applyFontSize(savedFontSize);
                
                // Set up event listeners for settings changes
                document.getElementById('themeSelect').addEventListener('change', (e) => {
                    const theme = e.target.value;
                    localStorage.setItem('theme', theme);
                    this.applyTheme(theme);
                });
                
                document.getElementById('fontSizeSlider').addEventListener('input', (e) => {
                    const fontSize = e.target.value;
                    localStorage.setItem('fontSize', fontSize);
                    this.applyFontSize(fontSize);
                });
                
                // Color picker functionality
                document.querySelectorAll('.color-option').forEach(option => {
                    option.addEventListener('click', () => {
                        const color = option.dataset.color;
                        localStorage.setItem('accentColor', color);
                        this.applyAccentColor(color);
                        
                        // Update selected state
                        document.querySelectorAll('.color-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        option.classList.add('selected');
                    });
                });
                
                // Save account settings
                document.getElementById('saveAccountSettings').addEventListener('click', () => this.saveAccountSettings());
                
                // Export data button
                document.getElementById('exportDataBtn').addEventListener('click', () => this.exportData());
                
                // Delete account button
                document.getElementById('deleteAccountBtn').addEventListener('click', () => {
                    this.showConfirmation("Are you sure you want to delete your account? This action cannot be undone.", () => this.deleteAccount());
                });
            }

            applyTheme(theme) {
                if (theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else if (theme === 'light') {
                    document.documentElement.removeAttribute('data-theme');
                } else {
                    // System default - follow OS preference
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.documentElement.setAttribute('data-theme', 'dark');
                    } else {
                        document.documentElement.removeAttribute('data-theme');
                    }
                }
            }

            applyAccentColor(color) {
                document.documentElement.style.setProperty('--primary', color);
                document.documentElement.style.setProperty('--primary-light', this.lightenColor(color, 0.2));
            }

            applyFontSize(size) {
                document.documentElement.style.setProperty('--base-font-size', `${size}px`);
            }

            lightenColor(color, amount) {
                // Simple function to lighten a color
                // In a real implementation, you'd use a proper color manipulation library
                return color; // Placeholder
            }

            saveAccountSettings() {
                // Save account settings to Firebase
                const userName = document.getElementById('userNameInput').value;
                const userEmail = document.getElementById('userEmailInput').value;
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Validation and Firebase update logic would go here
                this.showToast("Account settings updated successfully!", "success");
            }

            exportData() {
                // Export user data functionality
                this.showToast("Preparing your data export. You will receive an email when it's ready.", "success");
            }

            deleteAccount() {
                // Delete account functionality
                this.showConfirmation("Your account and all associated data will be permanently deleted.", async () => {
                    // Firebase account deletion logic would go here
                    this.showToast("Account deleted.", "success");
                });
            }
        }

        // Base Dashboard Component
        class BaseDashboard {
            constructor(app) {
                this.app = app;
            }

            createEmptyState(icon, message, buttonText = null, buttonAction = null) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                
                let buttonHtml = '';
                if (buttonText && buttonAction) {
                    const buttonId = 'empty-state-btn-' + Date.now();
                    buttonHtml = `<button class="btn btn-primary" id="${buttonId}">
                        <i class="fas fa-plus"></i> ${buttonText}
                    </button>`;
                    
                    setTimeout(() => {
                        document.getElementById(buttonId)?.addEventListener('click', buttonAction);
                    }, 0);
                }
                
                emptyState.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    <p>${message}</p>
                    ${buttonHtml}
                `;
                
                return emptyState;
            }

            createLoadingState() {
                const loadingState = document.createElement('div');
                loadingState.className = 'empty-state';
                loadingState.innerHTML = `
                    <div class="loading" style="width: 40px; height: 40px; margin: 0 auto 1rem;"></div>
                    <p>Loading...</p>
                `;
                return loadingState;
            }
        }

        // Student Dashboard Component
        class StudentDashboard extends BaseDashboard {
            render() {
                document.getElementById('dashboardContent').classList.remove('hidden');
                document.getElementById('roleSpecificContent').classList.add('hidden');
                document.getElementById('settingsContent').classList.add('hidden');
                
                this.loadStats();
                this.loadUpcomingSessions();
                this.loadRecentActivity();
            }

            async loadStats() {
                setTimeout(() => {
                    document.getElementById('upcomingSessionsCount').textContent = '2';
                    document.getElementById('completedSessionsCount').textContent = '15';
                    document.getElementById('availableTutorsCount').textContent = '8';
                }, 500);
            }

            async loadUpcomingSessions() {
                const container = document.getElementById('upcomingSessions');
                container.innerHTML = '';
                container.appendChild(this.createLoadingState());
                
                setTimeout(() => {
                    container.innerHTML = '';
                    
                    const demoSessions = [
                        {
                            id: 'session-1',
                            date: '2025-09-20',
                            startTime: '14:00',
                            endTime: '15:00',
                            tutorName: 'Dr. Sarah Johnson',
                            subject: 'Mathematics',
                            status: 'upcoming'
                        }
                    ];

                    if (demoSessions.length === 0) {
                        container.appendChild(
                            this.createEmptyState(
                                'clock', 
                                "You don't have any upcoming sessions.",
                                'Book a Session',
                                () => this.app.showToast('Booking feature coming soon!', 'warning')
                            )
                        );
                        return;
                    }

                    demoSessions.forEach(session => {
                        const sessionCard = this.createSessionCard(session);
                        container.appendChild(sessionCard);
                    });
                }, 1000);
            }

            createSessionCard(session) {
                const sessionCard = document.createElement('div');
                sessionCard.className = 'session-card';
                sessionCard.innerHTML = `
                    <div class="session-header">
                        <div class="slot-date">${session.date}</div>
                        <span class="slot-status status-upcoming">${session.status}</span>
                    </div>
                    <div class="slot-time">${session.startTime} - ${session.endTime}</div>
                    <div class="tutor-info">
                        <p><strong>Tutor:</strong> ${session.tutorName}</p>
                        <p><strong>Subject:</strong> ${session.subject}</p>
                    </div>
                    <div class="session-actions">
                        <button class="btn btn-outline btn-sm cancel-session" data-sessionid="${session.id}">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                `;

                sessionCard.querySelector('.cancel-session').addEventListener('click', () => {
                    this.handleCancelSession(session.id, sessionCard);
                });

                return sessionCard;
            }

            handleCancelSession(sessionId, card) {
                this.app.showConfirmation('Cancel this session?', async () => {
                    const button = card.querySelector('.cancel-session');
                    const originalContent = button.innerHTML;
                    button.innerHTML = '<div class="loading"></div>';
                    button.disabled = true;

                    setTimeout(() => {
                        card.classList.add('fade-out');
                        this.app.showToast('Session cancelled successfully!', 'success');
                        setTimeout(() => this.loadUpcomingSessions(), 2000);
                    }, 1500);
                });
            }

            async loadRecentActivity() {
                const container = document.getElementById('recentActivity');
                container.innerHTML = '';
                container.appendChild(this.createLoadingState());

                setTimeout(() => {
                    container.innerHTML = '';
                    
                    const demoActivities = [
                        {
                            type: 'completed',
                            tutorName: 'Dr. Sarah Johnson',
                            date: '2025-09-15',
                            subject: 'Mathematics'
                        },
                        {
                            type: 'booked',
                            tutorName: 'Prof. Michael Chen', 
                            date: '2025-09-22',
                            subject: 'Physics'
                        }
                    ];

                    if (demoActivities.length === 0) {
                        container.appendChild(
                            this.createEmptyState('history', 'No recent activity found.')
                        );
                        return;
                    }

                    demoActivities.forEach(activity => {
                        const activityItem = document.createElement('div');
                        activityItem.className = 'activity-item';

                        let activityText = '';
                        let activityIcon = 'fas fa-calendar';

                        switch (activity.type) {
                            case 'completed':
                                activityText = `Completed session with ${activity.tutorName} on ${activity.date}`;
                                activityIcon = 'fas fa-check-circle text-success';
                                break;
                            case 'cancelled':
                                activityText = `Cancelled session with ${activity.tutorName} scheduled for ${activity.date}`;
                                activityIcon = 'fas fa-times-circle text-danger';
                                break;
                            default:
                                activityText = `Booked session with ${activity.tutorName} for ${activity.date}`;
                                activityIcon = 'fas fa-calendar-plus text-primary';
                        }

                        activityItem.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--light-gray);">
                                <i class="${activityIcon}"></i>
                                <div>${activityText}</div>
                            </div>
                        `;

                        container.appendChild(activityItem);
                    });
                }, 800);
            }
        }

        // Tutor Dashboard Component
        class TutorDashboard extends BaseDashboard {
            render() {
                document.getElementById('dashboardContent').classList.add('hidden');
                document.getElementById('roleSpecificContent').classList.remove('hidden');
                document.getElementById('settingsContent').classList.add('hidden');
                
                this.renderTutorInterface();
                this.setupTutorEventListeners();
                this.loadTutorSlots();
                this.loadTutorSessions();
            }

            renderTutorInterface() {
                const container = document.getElementById('roleSpecificContent');
                container.innerHTML = `
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">Tutor Dashboard</h3>
                            <div class="section-actions">
                                <button class="btn btn-primary" id="showCreateSlotModal">
                                    <i class="fas fa-plus"></i> Create Slot
                                </button>
                            </div>
                        </div>
                        <p>Manage your availability and view your upcoming sessions.</p>
                    </div>
                    
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">Your Availability Slots</h3>
                        </div>
                        <div class="slots-container" id="tutorSlots">
                            </div>
                        <div class="text-center mt-20">
                            <button class="btn btn-outline" id="loadMoreTutorSlotsBtn">
                                <i class="fas fa-refresh"></i> Load More
                            </button>
                        </div>
                    </div>
                    
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">Upcoming Sessions</h3>
                        </div>
                        <div class="sessions-container" id="tutorSessions">
                            </div>
                    </div>
                `;
            }

            setupTutorEventListeners() {
                document.getElementById('showCreateSlotModal').addEventListener('click', () => {
                    this.app.showModal('createSlotModal');
                });

                document.getElementById('confirmCreateSlotBtn').addEventListener('click', () => {
                    this.handleCreateSlot();
                });

                document.getElementById('loadMoreTutorSlotsBtn').addEventListener('click', () => {
                    this.loadTutorSlots(true);
                });
            }

            async handleCreateSlot() {
                const date = document.getElementById('slotDate').value;
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;

                if (!date || !startTime || !endTime) {
                    this.app.showToast('Please fill all fields', 'warning');
                    return;
                }

                if (startTime >= endTime) {
                    this.app.showToast('End time must be after start time', 'warning');
                    return;
                }

                const button = document.getElementById('confirmCreateSlotBtn');
                const originalContent = button.innerHTML;
                button.innerHTML = '<div class="loading"></div>';
                button.disabled = true;

                setTimeout(() => {
                    this.app.hideModal('createSlotModal');
                    this.app.showToast('Availability slot created successfully!', 'success');
                    
                    // Clear form
                    document.getElementById('slotDate').value = '';
                    document.getElementById('startTime').value = '';
                    document.getElementById('endTime').value = '';
                    
                    // Reload slots
                    this.loadTutorSlots(false);
                    
                    button.innerHTML = originalContent;
                    button.disabled = false;
                }, 1500);
            }

            async loadTutorSlots(loadMore = false) {
                const container = document.getElementById('tutorSlots');
                const loadMoreBtn = document.getElementById('loadMoreTutorSlotsBtn');

                if (!loadMore) {
                    container.innerHTML = '';
                    container.appendChild(this.createLoadingState());
                }

                setTimeout(() => {
                    if (!loadMore) {
                        container.innerHTML = '';
                    }

                    const demoSlots = [
                        {
                            id: 'slot-1',
                            date: '2025-09-25',
                            startTime: '10:00',
                            endTime: '11:00'
                        },
                        {
                            id: 'slot-2',
                            date: '2025-09-26', 
                            startTime: '14:00',
                            endTime: '15:00'
                        }
                    ];

                    if (demoSlots.length === 0 && !loadMore) {
                        container.appendChild(
                            this.createEmptyState(
                                'calendar-plus',
                                "You haven't created any availability slots yet.",
                                'Create Your First Slot',
                                () => this.app.showModal('createSlotModal')
                            )
                        );
                        loadMoreBtn.style.display = 'none';
                        return;
                    }

                    demoSlots.forEach(slot => {
                        const slotCard = this.createSlotCard(slot);
                        container.appendChild(slotCard);
                    });

                    loadMoreBtn.style.display = demoSlots.length < 5 ? 'none' : 'block';
                }, loadMore ? 800 : 1200);
            }

            createSlotCard(slot) {
                const slotCard = document.createElement('div');
                slotCard.className = 'slot-card';

                const slotDateTime = new Date(`${slot.date}T${slot.startTime}`);
                const now = new Date();
                const hoursDiff = (slotDateTime - now) / (1000 * 60 * 60);

                let statusClass = 'status-upcoming';
                let statusText = 'Available';

                if (slotDateTime < now) {
                    statusClass = 'status-completed';
                    statusText = 'Past';
                }

                slotCard.innerHTML = `
                    <div class="slot-header">
                        <div class="slot-date">${slot.date}</div>
                        <span class="slot-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="slot-time">${slot.startTime} - ${slot.endTime}</div>
                    <div class="slot-actions">
                        ${hoursDiff > 24 ? `
                            <button class="btn btn-outline btn-sm cancel-slot" data-slotid="${slot.id}">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        ` : `
                            <span class="text-danger">Cannot cancel within 24 hours</span>
                        `}
                    </div>
                `;

                const cancelBtn = slotCard.querySelector('.cancel-slot');
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        this.handleCancelSlot(slot.id, slotCard);
                    });
                }

                return slotCard;
            }

            handleCancelSlot(slotId, card) {
                this.app.showConfirmation(
                    'Are you sure you want to cancel this slot and all associated bookings?',
                    async () => {
                        const button = card.querySelector('.cancel-slot');
                        const originalContent = button.innerHTML;
                        button.innerHTML = '<div class="loading"></div>';
                        button.disabled = true;

                        setTimeout(() => {
                            card.classList.add('fade-out');
                            this.app.showToast('Slot cancelled successfully!', 'success');
                            setTimeout(() => this.loadTutorSlots(false), 2000);
                        }, 2000);
                    }
                );
            }

            async loadTutorSessions() {
                const container = document.getElementById('tutorSessions');
                container.innerHTML = '';
                container.appendChild(this.createLoadingState());

                setTimeout(() => {
                    container.innerHTML = '';
                    
                    const demoSessions = [
                        {
                            id: 'tutor-session-1',
                            date: '2025-09-25',
                            startTime: '10:00',
                            endTime: '11:00',
                            studentName: 'Alice Johnson',
                            subject: 'Mathematics',
                            status: 'confirmed'
                        }
                    ];

                    if (demoSessions.length === 0) {
                        container.appendChild(
                            this.createEmptyState('clock', "You don't have any upcoming sessions.")
                        );
                        return;
                    }

                    demoSessions.forEach(session => {
                        const sessionCard = this.createTutorSessionCard(session);
                        container.appendChild(sessionCard);
                    });
                }, 1000);
            }

            createTutorSessionCard(session) {
                const sessionCard = document.createElement('div');
                sessionCard.className = 'session-card';

                sessionCard.innerHTML = `
                    <div class="session-header">
                        <div class="slot-date">${session.date}</div>
                        <span class="slot-status status-upcoming">${session.status}</span>
                    </div>
                    <div class="slot-time">${session.startTime} - ${session.endTime}</div>
                    <div class="student-info">
                        <p><strong>Student:</strong> ${session.studentName}</p>
                        <p><strong>Subject:</strong> ${session.subject}</p>
                    </div>
                    <div class="session-actions">
                        <button class="btn btn-primary btn-sm complete-session" data-sessionid="${session.id}">
                            <i class="fas fa-check"></i> Complete
                        </button>
                        <button class="btn btn-outline btn-sm cancel-session" data-sessionid="${session.id}">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                `;

                const completeBtn = sessionCard.querySelector('.complete-session');
                const cancelBtn = sessionCard.querySelector('.cancel-session');

                completeBtn.addEventListener('click', () => {
                    this.handleCompleteSession(session.id, sessionCard);
                });

                cancelBtn.addEventListener('click', () => {
                    this.handleCancelTutorSession(session.id, sessionCard);
                });

                return sessionCard;
            }

            handleCompleteSession(sessionId, card) {
                this.app.showConfirmation('Mark this session as completed?', async () => {
                    const button = card.querySelector('.complete-session');
                    const originalContent = button.innerHTML;
                    button.innerHTML = '<div class="loading"></div>';
                    button.disabled = true;

                    setTimeout(() => {
                        card.classList.add('fade-out');
                        this.app.showToast('Session marked as completed!', 'success');
                    }, 1500);
                });
            }

            handleCancelTutorSession(sessionId, card) {
                this.app.showConfirmation('Cancel this session?', async () => {
                    const button = card.querySelector('.cancel-session');
                    const originalContent = button.innerHTML;
                    button.innerHTML = '<div class="loading"></div>';
                    button.disabled = true;

                    setTimeout(() => {
                        card.classList.add('fade-out');
                        this.app.showToast('Session cancelled!', 'success');
                    }, 1500);
                });
            }
        }
        
        // --- NEW COMPONENT ---
        class TutorsComponent extends BaseDashboard {
            render() {
                const container = document.getElementById('roleSpecificContent');
                container.innerHTML = `
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">Find a Tutor</h3>
                        </div>
                        <div class="tutors-grid" id="tutorsGrid">
                        </div>
                    </div>
                `;
                
                this.loadTutors();
            }

            async loadTutors() {
                const container = document.getElementById('tutorsGrid');
                container.innerHTML = '';
                container.appendChild(this.createLoadingState());
                
                setTimeout(() => {
                    container.innerHTML = '';
                    
                    const demoTutors = [
                        {
                            id: 'tutor-1',
                            name: 'Dr. Sarah Johnson',
                            subjects: ['Mathematics', 'Statistics'],
                            bio: 'Experienced in advanced calculus and statistics for college students.',
                            rating: 4.8
                        },
                        {
                            id: 'tutor-2',
                            name: 'Prof. Michael Chen',
                            subjects: ['Physics', 'Astronomy'],
                            bio: 'Specializing in classical mechanics and astrophysics.',
                            rating: 4.9
                        },
                        {
                            id: 'tutor-3',
                            name: 'Ms. Emily Davis',
                            subjects: ['Chemistry', 'Biology'],
                            bio: 'Passionate about helping high school students with organic chemistry.',
                            rating: 4.7
                        }
                    ];

                    if (demoTutors.length === 0) {
                        container.appendChild(
                            this.createEmptyState(
                                'user-slash',
                                'No tutors are currently available.'
                            )
                        );
                        return;
                    }
                    
                    demoTutors.forEach(tutor => {
                        const tutorCard = this.createTutorCard(tutor);
                        container.appendChild(tutorCard);
                    });
                }, 1500);
            }
            
            createTutorCard(tutor) {
                const card = document.createElement('div');
                card.className = 'card tutor-card';
                card.innerHTML = `
                    <div class="tutor-header">
                        <i class="fas fa-user-circle tutor-avatar"></i>
                        <h4 class="tutor-name">${tutor.name}</h4>
                    </div>
                    <div class="tutor-info">
                        <p><strong>Subjects:</strong> ${tutor.subjects.join(', ')}</p>
                        <p><strong>Rating:</strong> ${tutor.rating} <i class="fas fa-star text-warning"></i></p>
                        <p>${tutor.bio}</p>
                    </div>
                    <div class="tutor-actions">
                        <button class="btn btn-primary btn-sm view-profile-btn" data-tutorid="${tutor.id}">
                            View Profile
                        </button>
                    </div>
                `;
                
                card.querySelector('.view-profile-btn').addEventListener('click', () => {
                    this.app.showToast(`Viewing profile for ${tutor.name}. Profile page coming soon!`, 'warning');
                });
                
                return card;
            }
        }
        // --- END NEW COMPONENT ---

        // Calendar Component
        class CalendarComponent extends BaseDashboard {
            constructor(app) {
                super(app);
                this.currentDate = new Date();
                this.selectedDate = new Date();
            }

            render() {
                const container = document.getElementById('roleSpecificContent');
                container.innerHTML = `
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">Calendar View</h3>
                            <div class="section-actions">
                                <button class="btn btn-outline" id="prevMonthBtn">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="btn btn-outline" id="todayBtn">
                                    Today
                                </button>
                                <button class="btn btn-outline" id="nextMonthBtn">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div id="calendarHeader" class="calendar-header">
                            </div>
                        <div id="calendarGrid" class="calendar-grid">
                            </div>
                    </div>
                    
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title" id="selectedDateTitle">Select a date to view available sessions</h3>
                        </div>
                        <div id="dateSessions" class="sessions-container">
                            </div>
                    </div>
                `;

                this.setupCalendarEventListeners();
                this.renderCalendar();
            }

            setupCalendarEventListeners() {
                document.getElementById('prevMonthBtn').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });

                document.getElementById('nextMonthBtn').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });

                document.getElementById('todayBtn').addEventListener('click', () => {
                    this.currentDate = new Date();
                    this.renderCalendar();
                });
            }

            renderCalendar() {
                const calendarHeader = document.getElementById('calendarHeader');
                const calendarGrid = document.getElementById('calendarGrid');
                
                // Set header
                const monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];
                calendarHeader.textContent = `${monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;
                
                // Clear grid
                calendarGrid.innerHTML = '';
                
                // Add day headers
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                days.forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day-header';
                    dayElement.textContent = day;
                    calendarGrid.appendChild(dayElement);
                });
                
                // Get first day of month and total days
                const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1).getDay();
                const daysInMonth = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0).getDate();
                
                // Add empty cells for days before the first day of the month
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'calendar-day empty';
                    calendarGrid.appendChild(emptyCell);
                }
                
                // Add cells for each day of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = day;
                    
                    // Check if this day has available sessions
                    const dateStr = `${this.currentDate.getFullYear()}-${String(this.currentDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    
                    // Add click event
                    dayElement.addEventListener('click', () => {
                        this.handleDateSelect(dateStr);
                    });
                    
                    calendarGrid.appendChild(dayElement);
                }
            }

            handleDateSelect(dateStr) {
                this.selectedDate = new Date(dateStr);
                document.getElementById('selectedDateTitle').textContent = `Available Sessions on ${dateStr}`;
                this.loadDateSessions(dateStr);
            }

            async loadDateSessions(date) {
                const container = document.getElementById('dateSessions');
                container.innerHTML = '';
                container.appendChild(this.createLoadingState());

                // Simulate API call to get available sessions for the selected date
                setTimeout(() => {
                    container.innerHTML = '';
                    
                    // Demo data - replace with actual API call
                    const demoSlots = [
                        {
                            id: 'slot-1',
                            tutorName: 'Dr. Sarah Johnson',
                            startTime: '10:00',
                            endTime: '11:00',
                            subject: 'Mathematics'
                        },
                        {
                            id: 'slot-2',
                            tutorName: 'Prof. Michael Chen',
                            startTime: '14:00',
                            endTime: '15:00',
                            subject: 'Physics'
                        }
                    ];

                    if (demoSlots.length === 0) {
                        container.appendChild(
                            this.createEmptyState('calendar-times', 'No available sessions on this date.')
                        );
                        return;
                    }

                    demoSlots.forEach(slot => {
                        const sessionCard = document.createElement('div');
                        sessionCard.className = 'session-card';
                        sessionCard.innerHTML = `
                            <div class="slot-time">${slot.startTime} - ${slot.endTime}</div>
                            <div class="tutor-info">
                                <p><strong>Tutor:</strong> ${slot.tutorName}</p>
                                <p><strong>Subject:</strong> ${slot.subject}</p>
                            </div>
                            <div class="session-actions">
                                <button class="btn btn-primary btn-sm book-session" data-slotid="${slot.id}">
                                    <i class="fas fa-book"></i> Book Now
                                </button>
                            </div>
                        `;

                        sessionCard.querySelector('.book-session').addEventListener('click', () => {
                            this.handleBookSession(slot.id, sessionCard);
                        });

                        container.appendChild(sessionCard);
                    });
                }, 1000);
            }

            handleBookSession(slotId, card) {
                this.app.showConfirmation('Book this session?', async () => {
                    const button = card.querySelector('.book-session');
                    const originalContent = button.innerHTML;
                    button.innerHTML = '<div class="loading"></div>';
                    button.disabled = true;

                    setTimeout(() => {
                        card.classList.add('fade-out');
                        this.app.showToast('Session booked successfully!', 'success');
                    }, 1500);
                });
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new SchedulerApp();
        });
    </script>
</body>
</html>
